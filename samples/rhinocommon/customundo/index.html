<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Custom Undo</title>
  <meta name="description" content="```cspartial class Examples{  static double MyFavoriteNumber = 0;">

  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/github.min.css">
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/languages/vbnet.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- Overridden theme -->
  <link rel="stylesheet" href="/css/main.css">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
  <!-- Bootstrap override -->
  <link rel="stylesheet" href="/css/bootstrap-override.css">

  <link rel="canonical" href="http://developer.rhino3d.com/samples/rhinocommon/customundo/">
  <link rel="alternate" type="application/rss+xml" title="Rhino Developer Docs" href="http://developer.rhino3d.com/feed.xml" />

  <link rel="shortcut icon" href="http://developer.rhino3d.com/favicon.ico?v=2" />
  <!-- Saving bookmarks to mobile devices -->
  <!-- For non-Retina (@1× display) iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png"><!-- 57×57px -->
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/images/apple-touch-icon-76x76-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/images/apple-touch-icon-120x120-precomposed.png">
  <!-- For iPad with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">
  <!-- For iPad with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/images/apple-touch-icon-152x152-precomposed.png">
  <!-- For iPhone 6 Plus with @3× display: -->
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/images/apple-touch-icon-180x180-precomposed.png">
  <!-- For Chrome for Android: -->
  <link rel="icon" sizes="192x192" href="images/touch-icon-192x192.png">

</head>


  <body>

    <!-- Google Tag Manager **This belongs right after the <body> tag**-->
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MWMDKN"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MWMDKN');
    </script>
    <!-- End Google Tag Manager -->


    


    <div class="container">

      <header class="site-header">


    <a class="site-title" href="/"><img src="/images/rhinodevlogo148x128.png" alt="Rhino Developer Docs" height="48" width="56"></a><a class="site-title" href="/">Rhino Developer Docs</a>

    <nav class="site-nav">
      <img class="menu-icon" src="/images/gi.svg">
      
      <div class="trigger">
      	<!--<a class="page-link" href="/">Welcome</a>-->
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
        
          
            
              
                <a class="page-link" href="/guides/">Guides</a>
              
            
          
        
          
            
              
                <a class="page-link" href="/api/">API</a>
              
            
          
        
          
            
              
                <a class="page-link" href="/samples/">Samples</a>
              
            
          
        
          
            
          
        
        <a class="page-link" href="http://discourse.mcneel.com/c/rhino-developer">Forums</a>
        <!-- Google Search Engine -->
        <!-- TODO Move to this site back into the Mcneel search, or use a simple site only search for results -->
        <div id="sitesearch">
            <!-- Google CSE Search Box Begins  -->
            <!-- Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
            <!-- The terms of service are available at https://www.google.com/cse/docs/tos.html -->
            <form id="cref" action="/search-results.html">
                <input type="hidden" name="cref" value="007988927381198593803:mcq6pshqsn8" />
                <input id="searchtext" type="text" name="q" size="24" value="" placeholder="search" />
                <input class="searchBox" type="submit" name="sa" size="2" value=" " />
            </form>
        <!-- Google CSE Search Box Ends -->
        </div>
        <!--End of Google Search Engine -->
      </div>
    </nav>

</header>


      <div class="page-content">
        <!--div class="wrapper"-->
          <h3>Custom Undo</h3>

<p></p>

<ul class="nav nav-pills">
  <li class="active"><a href="#cs" data-toggle="pill">C#</a></li>
  <li><a href="#vb" data-toggle="pill">VB.NET</a></li>
  <li><a href="#py" data-toggle="pill">Python</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane fade in active highlighter-rouge" id="cs"><pre class="highlight"><code><span class="k">partial</span> <span class="k">class</span> <span class="nc">Examples</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="kt">double</span> <span class="n">MyFavoriteNumber</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">static</span> <span class="n">Rhino</span><span class="p">.</span><span class="n">Commands</span><span class="p">.</span><span class="n">Result</span> <span class="nf">CustomUndo</span><span class="p">(</span><span class="n">RhinoDoc</span> <span class="n">doc</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// Rhino automatically sets up an undo record when a command is run,
</span>    <span class="c1">// but... the undo record is not saved if nothing changes in the
</span>    <span class="c1">// document (objects added/deleted, layers changed,...)
</span>    <span class="c1">//
</span>    <span class="c1">// If we have a command that doesn't change things in the document,
</span>    <span class="c1">// but we want to have our own custom undo called then we need to do
</span>    <span class="c1">// a little extra work
</span>
    <span class="kt">double</span> <span class="n">d</span> <span class="p">=</span> <span class="n">MyFavoriteNumber</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Rhino</span><span class="p">.</span><span class="n">Input</span><span class="p">.</span><span class="n">RhinoGet</span><span class="p">.</span><span class="nf">GetNumber</span><span class="p">(</span><span class="s">"Favorite number"</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">ref</span> <span class="n">d</span><span class="p">)</span> <span class="p">==</span> <span class="n">Rhino</span><span class="p">.</span><span class="n">Commands</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">double</span> <span class="n">current_value</span> <span class="p">=</span> <span class="n">MyFavoriteNumber</span><span class="p">;</span>
      <span class="n">doc</span><span class="p">.</span><span class="nf">AddCustomUndoEvent</span><span class="p">(</span><span class="s">"Favorite Number"</span><span class="p">,</span> <span class="n">OnUndoFavoriteNumber</span><span class="p">,</span> <span class="n">current_value</span><span class="p">);</span>
      <span class="n">MyFavoriteNumber</span> <span class="p">=</span> <span class="n">d</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">Rhino</span><span class="p">.</span><span class="n">Commands</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// event handler for custom undo
</span>  <span class="k">static</span> <span class="k">void</span> <span class="nf">OnUndoFavoriteNumber</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Rhino</span><span class="p">.</span><span class="n">Commands</span><span class="p">.</span><span class="n">CustomUndoEventArgs</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// !!!!!!!!!!
</span>    <span class="c1">// NEVER change any setting in the Rhino document or application.  Rhino
</span>    <span class="c1">// handles ALL changes to the application and document and you will break
</span>    <span class="c1">// the Undo/Redo commands if you make any changes to the application or
</span>    <span class="c1">// document. This is meant only for your own private plugin data
</span>    <span class="c1">// !!!!!!!!!!
</span>
    <span class="c1">// This function can be called either by undo or redo
</span>    <span class="c1">// In order to get redo to work, add another custom undo event with the
</span>    <span class="c1">// current value.  If you don't want redo to work, just skip adding
</span>    <span class="c1">// a custom undo event here
</span>    <span class="kt">double</span> <span class="n">current_value</span> <span class="p">=</span> <span class="n">MyFavoriteNumber</span><span class="p">;</span>
    <span class="n">e</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="nf">AddCustomUndoEvent</span><span class="p">(</span><span class="s">"Favorite Number"</span><span class="p">,</span> <span class="n">OnUndoFavoriteNumber</span><span class="p">,</span> <span class="n">current_value</span><span class="p">);</span>

    <span class="kt">double</span> <span class="n">old_value</span> <span class="p">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">e</span><span class="p">.</span><span class="n">Tag</span><span class="p">;</span>
    <span class="n">RhinoApp</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Going back to your favorite = {0}"</span><span class="p">,</span> <span class="n">old_value</span><span class="p">);</span>
    <span class="n">MyFavoriteNumber</span> <span class="p">=</span> <span class="n">old_value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<pre class="tab-pane fade in" id="vb"><code class="language-vbnet">Partial Friend Class Examples
  Private Shared MyFavoriteNumber As Double = 0

  Public Shared Function CustomUndo(ByVal doc As RhinoDoc) As Rhino.Commands.Result
	' Rhino automatically sets up an undo record when a command is run,
	' but... the undo record is not saved if nothing changes in the
	' document (objects added/deleted, layers changed,...)
	'
	' If we have a command that doesn't change things in the document,
	' but we want to have our own custom undo called then we need to do
	' a little extra work

	Dim d As Double = MyFavoriteNumber
	If Rhino.Input.RhinoGet.GetNumber("Favorite number", True, d) = Rhino.Commands.Result.Success Then
	  Dim current_value As Double = MyFavoriteNumber
	  doc.AddCustomUndoEvent("Favorite Number", AddressOf OnUndoFavoriteNumber, current_value)
	  MyFavoriteNumber = d
	End If
	Return Rhino.Commands.Result.Success
  End Function

  ' event handler for custom undo
  Private Shared Sub OnUndoFavoriteNumber(ByVal sender As Object, ByVal e As Rhino.Commands.CustomUndoEventArgs)
	' !!!!!!!!!!
	' NEVER change any setting in the Rhino document or application.  Rhino
	' handles ALL changes to the application and document and you will break
	' the Undo/Redo commands if you make any changes to the application or
	' document. This is meant only for your own private plugin data
	' !!!!!!!!!!

	' This function can be called either by undo or redo
	' In order to get redo to work, add another custom undo event with the
	' current value.  If you don't want redo to work, just skip adding
	' a custom undo event here
	Dim current_value As Double = MyFavoriteNumber
	e.Document.AddCustomUndoEvent("Favorite Number", AddressOf OnUndoFavoriteNumber, current_value)

	Dim old_value As Double = CDbl(e.Tag)
	RhinoApp.WriteLine("Going back to your favorite = {0}", old_value)
	MyFavoriteNumber = old_value
  End Sub
End Class
</code></pre>

<div class="tab-pane fade in highlighter-rouge" id="py"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">Rhino</span>
<span class="kn">import</span> <span class="nn">scriptcontext</span>


<span class="k">def</span> <span class="nf">OnUndoFavoriteNumber</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="s">"""!!!!!!!!!!
    NEVER change any setting in the Rhino document or application.  Rhino
    handles ALL changes to the application and document and you will break
    the Undo/Redo commands if you make any changes to the application or
    document. This is meant only for your own private plugin data
    !!!!!!!!!!

    This function can be called either by undo or redo
    In order to get redo to work, add another custom undo event with the
    current value.  If you don't want redo to work, just skip adding
    a custom undo event here
    """</span>
    <span class="n">current_value</span> <span class="o">=</span> <span class="n">scriptcontext</span><span class="o">.</span><span class="n">sticky</span><span class="p">[</span><span class="s">"FavoriteNumber"</span><span class="p">]</span>
    <span class="n">e</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">AddCustomUndoEvent</span><span class="p">(</span><span class="s">"Favorite Number"</span><span class="p">,</span> <span class="n">OnUndoFavoriteNumber</span><span class="p">,</span> <span class="n">current_value</span><span class="p">)</span>

    <span class="n">old_value</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">Tag</span>
    <span class="k">print</span> <span class="s">"Going back to your favorite ="</span><span class="p">,</span> <span class="n">old_value</span>
    <span class="n">scriptcontext</span><span class="o">.</span><span class="n">sticky</span><span class="p">[</span><span class="s">"FavoriteNumber"</span><span class="p">]</span><span class="o">=</span> <span class="n">old_value</span><span class="p">;</span>


<span class="k">def</span> <span class="nf">TestCustomUndo</span><span class="p">():</span>
    <span class="s">"""Rhino automatically sets up an undo record when a command is run,
       but... the undo record is not saved if nothing changes in the
       document (objects added/deleted, layers changed,...)

       If we have a command that doesn't change things in the document,
       but we want to have our own custom undo called then we need to do
       a little extra work
    """</span>
    <span class="n">current_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">scriptcontext</span><span class="o">.</span><span class="n">sticky</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">"FavoriteNumber"</span><span class="p">):</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="n">scriptcontext</span><span class="o">.</span><span class="n">sticky</span><span class="p">[</span><span class="s">"FavoriteNumber"</span><span class="p">]</span>
    <span class="n">rc</span><span class="p">,</span> <span class="n">new_value</span> <span class="o">=</span> <span class="n">Rhino</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">RhinoGet</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">"Favorite number"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">current_value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rc</span><span class="o">!=</span><span class="n">Rhino</span><span class="o">.</span><span class="n">Commands</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">Success</span><span class="p">:</span> <span class="k">return</span>

    <span class="n">scriptcontext</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">AddCustomUndoEvent</span><span class="p">(</span><span class="s">"Favorite Number"</span><span class="p">,</span> <span class="n">OnUndoFavoriteNumber</span><span class="p">,</span> <span class="n">current_value</span><span class="p">);</span>
    <span class="n">scriptcontext</span><span class="o">.</span><span class="n">sticky</span><span class="p">[</span><span class="s">"FavoriteNumber"</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">TestCustomUndo</span><span class="p">()</span>
</code></pre>
</div>

</div>

        <!--/div-->
      </div>

      <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      

        <div class="row">
          <div class="col-md-3">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>
              <a href="https://github.com/mcneel/developer-rhino3d-com/blob/master/_samples/rhinocommon/customundo.md" target="_blank">Edit on GitHub</a>
          </div>

          <div class="col-md-6 text-center">
            © 1997 - 2016 Robert McNeel &amp; Associates
          </div>

          <div class="col-md-3">
            <span class="pull-right">
              <span class="glyphicon glyphicon-cog"></span>&nbsp;<a href="/admin">Admin</a>
            </span>
          </div>

        </div>

      

    </div>

  </div>

  <script>
    if (navigator.appVersion.indexOf("Win")!=-1)
    {
      var body = document.getElementsByTagName("body");
      body[0].style.fontWeight = '400';
    }
  </script>

</footer>

    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <!-- MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
    $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 150 /* fixed header is about 40px high */
    });
    </script>
  </body>

</html>
