<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Showing Objects Transforming Dynamically</title>
  <meta name="description" content="Showing Objects Transforming Dynamically">

  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/github.min.css">
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/languages/vbnet.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- Overridden theme -->
  <link rel="stylesheet" href="/wip/css/main.css">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
  <!-- Bootstrap override -->
  <link rel="stylesheet" href="/wip/css/bootstrap-override.css">

  <link rel="canonical" href="http://developer.rhino3d.com/wip/guides/cpp/showing_objects_transforming_dynamically/">
  <link rel="alternate" type="application/rss+xml" title="Rhino Developer Docs" href="http://developer.rhino3d.com/wip/feed.xml" />

  <link rel="shortcut icon" href="http://developer.rhino3d.com/favicon.ico?v=2" />
  <!-- Saving bookmarks to mobile devices -->
  <!-- For non-Retina (@1× display) iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="/wip/images/apple-touch-icon-precomposed.png"><!-- 57×57px -->
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/wip/images/apple-touch-icon-72x72-precomposed.png">
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/wip/images/apple-touch-icon-76x76-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/wip/images/apple-touch-icon-114x114-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/wip/images/apple-touch-icon-120x120-precomposed.png">
  <!-- For iPad with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/wip/images/apple-touch-icon-144x144-precomposed.png">
  <!-- For iPad with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/wip/images/apple-touch-icon-152x152-precomposed.png">
  <!-- For iPhone 6 Plus with @3× display: -->
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/wip/images/apple-touch-icon-180x180-precomposed.png">
  <!-- For Chrome for Android: -->
  <link rel="icon" sizes="192x192" href="images/touch-icon-192x192.png">

  <!-- Diable crawling until this version is the stable version -->
  <meta name="robots" content="noindex" />
</head>


  <body>

    <!-- Google Tag Manager **This belongs right after the <body> tag**-->
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MWMDKN"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MWMDKN');
    </script>
    <!-- End Google Tag Manager -->


    
<div class="version-banner">
    Hey, you're viewing the <strong>wip</strong> version of this page!
    <a href="/guides/cpp/showing_objects_transforming_dynamically/">View the current version instead.</a>
</div>



    <div class="container">

      <header class="site-header">


    <a class="site-title" href="/wip/"><img src="/wip/images/rhinodevlogo148x128.png" alt="Rhino Developer Docs" height="48" width="56"></a><a class="site-title" href="/wip/">Rhino Developer Docs</a>

    <nav class="site-nav">
      <img class="menu-icon" src="/wip/images/gi.svg">
      
      <div class="trigger">
      	<!--<a class="page-link" href="/wip/">Welcome</a>-->
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
        
          
            
              
                <a class="page-link" href="/wip/guides/">Guides</a>
              
            
          
        
          
            
              
                <a class="page-link" href="/wip/api/">API</a>
              
            
          
        
          
            
              
                <a class="page-link" href="/wip/samples/">Samples</a>
              
            
          
        
          
            
          
        
        <a class="page-link" href="http://discourse.mcneel.com/c/rhino-developer">Forums</a>
        <!-- Google Search Engine -->
        <!-- TODO Move to this site back into the Mcneel search, or use a simple site only search for results -->
        <div id="sitesearch">
            <!-- Google CSE Search Box Begins  -->
            <!-- Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
            <!-- The terms of service are available at https://www.google.com/cse/docs/tos.html -->
            <form id="cref" action="/wip/search-results.html">
                <input type="hidden" name="cref" value="007988927381198593803:mcq6pshqsn8" />
                <input id="searchtext" type="text" name="q" size="24" value="" placeholder="search" />
                <input class="searchBox" type="submit" name="sa" size="2" value=" " />
            </form>
        <!-- Google CSE Search Box Ends -->
        </div>
        <!--End of Google Search Engine -->
      </div>
    </nav>

</header>


      <div class="page-content">
        <!--div class="wrapper"-->
          <div class="container-fluid">

<div class="row-fluid">
    <!--Nav Bar -->
    <nav class="col-xs-0 col-md-3 bs-docs-sidebar">
        <ul id="sidebar" class="nav nav-stacked fixed">

          <li>
            <a href="/wip/guides/">Guides</a>

            <ul class="nav nav-stacked">

              <li>

                
                  <a href="/wip/guides/#cpp">C/C++</a>
                
                <ul class="nav nav-stacked">

                  <!-- Find the h1 handle for title -->
                  
                  
                  
                  
                  
                  
                  
                  <li>
                    <a href="#showing-objects-transforming-dynamically">Showing Objects Transform...</a>

                    <ul class="nav nav-stacked">

                      <!-- Find the h2 group and any h3 subgroups -->
                      

                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#overview">Overview</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#sample">Sample</a>

                          

                        </li>
                      

                    </ul>

                  </li>

                </ul>

              </li>

            </ul>

          </li>

        </ul>
    </nav>
    <!--Main Content -->
    <div class="col-xs-12 col-md-9">
      <!--<div class="post">-->

        <article class="post-content">
          <h1 id="showing-objects-transforming-dynamically">Showing Objects Transforming Dynamically</h1>

<p>This guide demonstrates how to dynamically draw transforming objects using C/C++.</p>

<h2 id="overview">Overview</h2>

<p>The <code class="highlighter-rouge">CRhinoViewport</code> class has two member functions, <code class="highlighter-rouge">GetModelXform()</code> and <code class="highlighter-rouge">SetModelXform()</code>, that either retrieve or modify the model transformation matrix that is applied to objects before they are drawn.  The model transformation matrix is intended to be used for dynamic drawing of objects.  Note, the default model transformation matrix is the identity.</p>

<p>Some of the Rhino command that use this technique to dynamically draw transforming objects include the <em>Move</em>, <em>Copy</em>, <em>Scale</em>, and <em>Rotate</em> commands.  These commands derive new <code class="highlighter-rouge">CRhinoGetPoint</code> classes and override the virtual <code class="highlighter-rouge">DynamicDraw()</code> member function to draw objects dynamically as the mouse moves during a point picking operation.</p>

<h2 id="sample">Sample</h2>

<p>The following is an sample <code class="highlighter-rouge">CRhinoGetPoint</code>-derived class that demonstrates how to dynamically draw transforming objects during a point picking operation.  In this sample, the transformation is a simple translation, like used in the <em>Move</em> command.</p>

<p>First, the class declaration…</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="c1">////////////////////////////////////////////////////////////////////
// CRhinoGetTranslationPoint declaration
</span>
<span class="k">class</span> <span class="nc">CRhinoGetTranslationPoint</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CRhinoGetPoint</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>

  <span class="n">CRhinoGetTranslationPoint</span><span class="p">();</span>
  <span class="o">~</span><span class="n">CRhinoGetTranslationPoint</span><span class="p">()</span> <span class="p">{}</span>

  <span class="c1">// CRhinoGetPoint overrides  
</span>  <span class="kt">void</span> <span class="n">SetBasePoint</span><span class="p">(</span> <span class="n">ON_3dPoint</span> <span class="n">base_point</span><span class="p">,</span> <span class="n">BOOL</span> <span class="n">bShowDistanceInStatusBar</span> <span class="o">=</span> <span class="nb">false</span> <span class="p">);</span>
  <span class="kt">void</span> <span class="n">OnMouseMove</span><span class="p">(</span> <span class="n">CRhinoViewport</span><span class="o">&amp;</span> <span class="n">vp</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">flags</span><span class="p">,</span> <span class="k">const</span> <span class="n">ON_3dPoint</span><span class="o">&amp;</span> <span class="n">pt</span><span class="p">,</span> <span class="k">const</span> <span class="n">CPoint</span><span class="o">*</span> <span class="n">p</span> <span class="p">);</span>
  <span class="kt">void</span> <span class="n">DynamicDraw</span><span class="p">(</span> <span class="n">HDC</span> <span class="n">hdc</span><span class="p">,</span> <span class="n">CRhinoViewport</span><span class="o">&amp;</span> <span class="n">vp</span><span class="p">,</span> <span class="k">const</span> <span class="n">ON_3dPoint</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="p">);</span>

  <span class="c1">// Additional helpers
</span>  <span class="kt">void</span> <span class="n">AddObject</span><span class="p">(</span> <span class="k">const</span> <span class="n">CRhinoObject</span><span class="o">*</span> <span class="n">object</span> <span class="p">);</span>
  <span class="kt">void</span> <span class="n">CalculateTranslation</span><span class="p">(</span> <span class="k">const</span> <span class="n">ON_3dPoint</span><span class="o">&amp;</span> <span class="n">pt</span><span class="p">,</span> <span class="n">ON_Xform</span><span class="o">&amp;</span> <span class="n">xform</span> <span class="p">);</span>

<span class="k">private</span><span class="o">:</span>
  <span class="n">ON_3dPoint</span> <span class="n">m_start_point</span><span class="p">;</span> <span class="c1">// starting point of translation
</span>  <span class="n">ON_Xform</span> <span class="n">m_xform</span><span class="p">;</span> <span class="c1">// transformation matrix
</span>  <span class="n">ON_SimpleArray</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">CRhinoObject</span><span class="o">*&gt;</span> <span class="n">m_objects</span><span class="p">;</span> <span class="c1">//objects to transform
</span><span class="p">};</span>

<span class="c1">////////////////////////////////////////////////////////////////////
// CRhinoGetTranslationPoint definition
</span>
<span class="n">CRhinoGetTranslationPoint</span><span class="o">::</span><span class="n">CRhinoGetTranslationPoint</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">m_xform</span><span class="p">.</span><span class="n">Identity</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CRhinoGetTranslationPoint</span><span class="o">::</span><span class="n">AddObject</span><span class="p">(</span> <span class="k">const</span> <span class="n">CRhinoObject</span><span class="o">*</span> <span class="n">object</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">m_objects</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">object</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CRhinoGetTranslationPoint</span><span class="o">::</span><span class="n">SetBasePoint</span><span class="p">(</span>
      <span class="n">ON_3dPoint</span> <span class="n">base_point</span><span class="p">,</span>
      <span class="n">BOOL</span> <span class="n">bShowDistanceInStatusBar</span>
      <span class="p">)</span>
<span class="p">{</span>
  <span class="n">m_start_point</span> <span class="o">=</span> <span class="n">base_point</span><span class="p">;</span>
  <span class="n">CRhinoGetPoint</span><span class="o">::</span><span class="n">SetBasePoint</span><span class="p">(</span> <span class="n">base_point</span><span class="p">,</span> <span class="n">bShowDistanceInStatusBar</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CRhinoGetTranslationPoint</span><span class="o">::</span><span class="n">CalculateTranslation</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">ON_3dPoint</span><span class="o">&amp;</span> <span class="n">pt</span><span class="p">,</span>
      <span class="n">ON_Xform</span><span class="o">&amp;</span> <span class="n">xform</span>
      <span class="p">)</span>
<span class="p">{</span>
  <span class="n">ON_3dVector</span> <span class="n">v</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">-</span> <span class="n">m_start_point</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">v</span><span class="p">.</span><span class="n">IsTiny</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">xform</span><span class="p">.</span><span class="n">Identity</span><span class="p">();</span>
  <span class="k">else</span>
    <span class="n">xform</span><span class="p">.</span><span class="n">Translation</span><span class="p">(</span> <span class="n">v</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CRhinoGetTranslationPoint</span><span class="o">::</span><span class="n">OnMouseMove</span><span class="p">(</span>
     <span class="n">CRhinoViewport</span><span class="o">&amp;</span> <span class="n">vp</span><span class="p">,</span>
     <span class="n">UINT</span> <span class="n">flags</span><span class="p">,</span>
     <span class="k">const</span> <span class="n">ON_3dPoint</span><span class="o">&amp;</span> <span class="n">pt</span><span class="p">,</span>
     <span class="k">const</span> <span class="n">CPoint</span><span class="o">*</span> <span class="n">p</span>
     <span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Everytime the mouse moves, calculate the translation
</span>  <span class="n">CalculateTranslation</span><span class="p">(</span> <span class="n">pt</span><span class="p">,</span> <span class="n">m_xform</span> <span class="p">);</span>
  <span class="n">CRhinoGetPoint</span><span class="o">::</span><span class="n">OnMouseMove</span><span class="p">(</span> <span class="n">vp</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">p</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CRhinoGetTranslationPoint</span><span class="o">::</span><span class="n">DynamicDraw</span><span class="p">(</span>
     <span class="n">HDC</span> <span class="n">hdc</span><span class="p">,</span>
     <span class="n">CRhinoViewport</span><span class="o">&amp;</span> <span class="n">vp</span><span class="p">,</span>
     <span class="k">const</span> <span class="n">ON_3dPoint</span><span class="o">&amp;</span> <span class="n">pt</span>
     <span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Time to draw our objects dynamically
</span>  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">m_objects</span><span class="p">.</span><span class="n">Count</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">m_xform</span><span class="p">.</span><span class="n">IsIdentity</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">ON_Color</span> <span class="n">saved_color</span> <span class="o">=</span> <span class="n">vp</span><span class="p">.</span><span class="n">DrawColor</span><span class="p">();</span>
    <span class="n">ON_Xform</span> <span class="n">saved_model_xform</span><span class="p">;</span>
    <span class="c1">// Save the current model transformation, we will
</span>    <span class="c1">// need to restore it later
</span>    <span class="n">vp</span><span class="p">.</span><span class="n">GetModelXform</span><span class="p">(</span> <span class="n">saved_model_xform</span> <span class="p">);</span>
    <span class="c1">// Set the model transformation to ours
</span>    <span class="n">vp</span><span class="p">.</span><span class="n">SetModelXform</span><span class="p">(</span> <span class="n">m_xform</span> <span class="p">);</span>
    <span class="c1">// Draw all of the objects in our array
</span>    <span class="k">for</span><span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_objects</span><span class="p">.</span><span class="n">Count</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">const</span> <span class="n">CRhinoObject</span><span class="o">*</span> <span class="n">object</span> <span class="o">=</span> <span class="n">m_objects</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">object</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="n">vp</span><span class="p">.</span><span class="n">SetDrawColor</span><span class="p">(</span> <span class="n">object</span><span class="o">-&gt;</span><span class="n">ObjectDrawColor</span><span class="p">(</span><span class="n">TRUE</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">object</span><span class="o">-&gt;</span><span class="n">Draw</span><span class="p">(</span> <span class="n">vp</span> <span class="p">);</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">vp</span><span class="p">.</span><span class="n">InterruptDrawing</span><span class="p">()</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Reset modified viewport members
</span>    <span class="n">vp</span><span class="p">.</span><span class="n">SetModelXform</span><span class="p">(</span> <span class="n">saved_model_xform</span> <span class="p">);</span>
    <span class="n">vp</span><span class="p">.</span><span class="n">SetDrawColor</span><span class="p">(</span> <span class="n">saved_color</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Let the base class do its drawing too
</span>  <span class="n">CRhinoGetPoint</span><span class="o">::</span><span class="n">DynamicDraw</span><span class="p">(</span> <span class="n">hdc</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">pt</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

        </article>

      <!--</div>-->

    </div>
</div>
</div>

        <!--/div-->
      </div>

      <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      
        <div class="row">
          <div class="col-md-4">
            <p class="text">Author: <a href="mailto:dale@mcneel.com">dale@mcneel.com</a></p>
          </div>
          <div class="col-md-4 text-center">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <a href="https://github.com/mcneel/developer-rhino3d-com/blob/wip/_guide_topics/cpp/showing_objects_transforming_dynamically.md" target="_blank">Edit page on GitHub</a>
          </div>
            <div class="col-md-4">
              <span class="pull-right">
                <span class="glyphicon glyphicon-cog"></span>&nbsp;<a href="/wip/admin">Admin</a>
              </span>
            </div>
        </div>

        <div class="row text-center">
          © 1997 - 2016 Robert McNeel &amp; Associates
        </div>

      

    </div>

  </div>

  <script>
    if (navigator.appVersion.indexOf("Win")!=-1)
    {
      var body = document.getElementsByTagName("body");
      body[0].style.fontWeight = '400';
    }
  </script>

</footer>

    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <!-- MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
    $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 150 /* fixed header is about 40px high */
    });
    </script>
  </body>

</html>
